<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../layui225/css/layui.css" media="all">
    <style>
        input{
            text-align: center;
        }
        label{
            font-family: "微软雅黑", Verdana;
            font-size: 19px;
        }
        .small{
            width:100px;
            text-align: right;
        }
        #jcr{
            /*width:120px;*/
        }
        .kh_switch{
            display: none;
        }
        .layui-form-item{
            width: 1170px;
        }
        textarea{
            font-size: 19px;
            font-family: "微软雅黑", Verdana;
            letter-spacing: 2px;
        }

    </style>
</head>

<body>
<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
<!--[if lt IE 9]>
<script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
<script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<div class="layui-container">
<!--标题-->
    <div  style="margin: 10px auto 20px auto;text-align: center">
        <div class="layui-input-inline">
            <img src="../../images/wtk.png" alt="">
        </div>
    </div>
    <div class="content" >
        <form class="layui-form" id="form1" method="post" >
        <!--问题录入-->
        <div class="wtlr">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
                <legend>问题录入</legend>
            </fieldset>
            <!--第一行-->
            <div class="layui-form-item">
                <div class="layui-inline" >
                    <label class="layui-form-label">检查时间</label>
                    <div class="layui-input-inline">
                        <input type="text" name="jc_date"  autocomplete="off"  placeholder="yyyy-MM-dd"  class="layui-input" id="jc_date" readonly="readonly" lay-verify="required" value=<?php echo date('Y-m-d',time());?>>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">检查人员</label>
                    <div class="layui-input-inline">
                        <input type="text" name="jcr" id="jcr" placeholder="请输入检查人员"  autocomplete="off" class="layui-input"  maxlength="11" lay-verify="required" value="<?php echo $_SESSION['name'];?>">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label small">检 查 部 门</label>
                    <div class="layui-input-inline">
                        <select name="jc_bm" lay-verify="required" lay-search>
                            <option value=<?php echo $_SESSION['bm'];?> selected="selected"><?php echo $_SESSION['bm'];?></option>
                            <?php foreach ($jc_bm as $value) {?>
                                <option value=<?php echo $value;?>><?php echo $value;?></option>
                            <?php }?>
                        </select>
                    </div>
                </div>
            </div>
            <!--第二行-->
            <div class="layui-form-item">
                <div class="layui-inline" >
                    <label class="layui-form-label">问题区段</label>
                    <div class="layui-input-inline">
                        <select name="wt_qd" lay-verify="required" lay-search>
                            <option value="">请选择问题区段</option>
                            <?php foreach ($wt_qd as $key=>$value) {?>
                            <option value=<?php echo $value;?>><?php echo $key;?></option>
                            <?php }?>
                        </select>
                    </div>
                </div>
                <div class="layui-inline" >
                    <label class="layui-form-label">问题分类</label>
                    <div class="layui-input-inline">
                        <select name="wt_fl" lay-verify="required" lay-search>
                            <option value="">请选择问题分类</option>
                            <?php foreach ($wt_fl as $key=>$value) {?>
                            <option value=<?php echo $value;?>><?php echo $value;?></option>
                            <?php }?>
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label small">专 业 类 别</label>
                    <div class="layui-input-inline">
                        <select name="zylb" lay-verify="required" lay-search>
                            <option value="">请选择专业类别</option>
                            <?php foreach ($zylb as $key=>$value) {?>
                            <option value=<?php echo $value;?>><?php echo $value;?></option>
                            <?php }?>
                        </select>
                    </div>
                </div>
            </div>
            <!--第三行-->
            <div class="layui-form-item">
                <div class="layui-inline" >
                    <label class="layui-form-label">责任单位</label>
                    <div class="layui-input-inline">
                        <select name="zrdw" lay-verify="required" lay-search>
                            <option value="">请选择责任单位</option>
                            <?php foreach ($zrdw as $key=>$value) {?>
                                <option value=<?php echo $value;?>><?php echo $value;?></option>
                            <?php }?>
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">责任人员</label>
                    <div class="layui-input-inline">
                        <input type="text" name="zrr" id="zrr" placeholder="请输入责任人员" autocomplete="off" class="layui-input" maxlength="11">
                    </div>
                </div>
                <div class="layui-inline" >
                    <label class="layui-form-label small">整 改 日 期</label>
                    <div class="layui-input-inline">
                        <input type="text" name="zg_date"  autocomplete="off"  placeholder="yyyy-MM-dd"  class="layui-input" id="zg_date" >
                    </div>
                </div>
            </div>
            <!--第四行-->
            <div class="layui-form-item">
                <div class="layui-inline" >
                    <label class="layui-form-label">问题来源</label>
                    <div class="layui-input-inline">
                        <select id="wt_ly" name="wt_ly" lay-verify="required" lay-search>
                            <option value="">请选择问题标志</option>
                            <?php foreach ($wt_ly as $key=>$value) {?>
                            <option value=<?php echo $value;?>><?php echo $value;?></option>
                            <?php }?>
                        </select>
                    </div>
                </div>
                <!--重点问题-->
                <div class="layui-inline" >
                    <label class="layui-form-label" >重点问题</label>
                    <div class="layui-input-inline" style="width: 100px;">
                        <input type="checkbox" name="is_zdwt" title="重点问题" >
                    </div>
                </div>
                <div class="layui-inline" >
                    <label class="layui-form-label" >纳入分析</label>
                    <div class="layui-input-inline" style="width: 100px;">
                        <input type="checkbox" name="is_fx" title="纳入分析" checked>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label" >是否考核</label>
                    <div class="layui-input-inline" >
                        <input type="checkbox" id="is_kh" name="is_kh" lay-filter="is_kh"  lay-skin="switch" lay-text="开启|关闭">
                    </div>
                </div>
            </div>
        </div>
        <!--考核相关-->
        <div class="kh_switch" lay-filter="kh">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
                <legend>考核相关</legend>
            </fieldset>
            <!--考核第一行-->
            <div class="layui-form-item">
                <div class="layui-inline" >
                    <label class="layui-form-label" style="width: 100px;">考核人职务</label>
                    <div class="layui-input-inline">
                        <select name="khr_zw" lay-search id="khr_zw">
                            <option value="<?php echo $_SESSION['zw'];?>"><?php echo $_SESSION['zw'];?></option>
                            <?php foreach ($khr_zw as $key=>$value) {?>
                            <option value=<?php echo $value;?>><?php echo $value;?></option>
                            <?php }?>
                        </select>
                    </div>
                </div>
                <div class="layui-inline" >
                    <label class="layui-form-label" style="width: 115px;">被考核部门&nbsp;&nbsp;</label>
                    <div class="layui-input-inline">
                        <select name="bkh_bm"   lay-search  id="bkh_bm">
                            <option value="">请选择被考核部门</option>
                            <?php foreach ($bkh_bm as $key=>$value) {?>
                            <option value=<?php echo $value;?>><?php echo $value;?></option>
                            <?php }?>
                        </select>
                    </div>
                </div>
                <div class="layui-inline" >
                    <label class="layui-form-label" style="width: 115px;">被考核人身份</label>
                    <div class="layui-input-inline">
                        <select name="bkhr_sf"  lay-search id="bkhr_sf">
                            <option value="">请选择被考核人身份</option>
                            <?php foreach ($bkhr_sf as $key=>$value) {?>
                            <option value=<?php echo $value;?>><?php echo $value;?></option>
                            <?php }?>
                        </select>
                    </div>
                </div>
            </div>
            <!--考核第二行-->
            <div class="layui-form-item">
                <div class="layui-inline" >
                    <label class="layui-form-label" style="width: 100px;">考 核 类 别</label>
                    <div class="layui-input-inline">
                        <select name="kh_lb" lay-search id="kh_lb">
                            <option value="">请选择考核类别</option>
                            <?php foreach ($kh_lb as $key=>$value) {?>
                                <option value=<?php echo $value;?>><?php echo $value;?></option>
                            <?php }?>
                        </select>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 115px;">考核项点选择</label>
                    <div class="layui-input-inline">
                        <select name="kh_xd" lay-search id="kh_xd">
                            <option value="">请选择考核项点</option>
                            <?php foreach ($khxd_data as $value) {?>
                            <option value=<?php echo $value['bh'].'—'.$value['wtnr'];?>><?php echo $value['bh'].'—'.$value['wtnr'];?></option>
                            <?php }?>
                        </select>
                    </div>
                </div>
                <div class="layui-inline" >
                    <label class="layui-form-label small" style="width: 115px;">考 核 减 分&nbsp&nbsp;</label>
                    <div class="layui-input-inline">
                        <input type="text" name="kh_jf"  placeholder="请输入考核减分"  class="layui-input" id="kh_jf" maxlength="2" id="kh_jf"  onkeyup="this.value=this.value.replace(/\D/g,'')"  onafterpaste="this.value=this.value.replace(/\D/g,'')">
                    </div>
                </div>
            </div>
        </div>
        <!--具体问题与整改要求-->
        <div class="jtwt">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
                <legend>具体问题</legend>
            </fieldset>
            <!--具体问题-->
            <textarea name="jtwt" required lay-verify="required" placeholder="请输入具体问题" class="layui-textarea"></textarea>
            <!--整改要求-->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
                <legend>整改要求</legend>
            </fieldset>
            <textarea name="zgyq" required lay-verify="required" placeholder="请输入整改要求" class="layui-textarea" style="height: 10px;"></textarea>
        </div>
        <!--提交按钮-->
        <div  style="margin: 10px auto;text-align: center">
            <div class="layui-input-inline">
                <button type="reset" class="layui-btn layui-btn-lg layui-btn-danger" id="reset">清除所有</button>
                <button class="layui-btn layui-btn-lg " lay-submit  lay-filter="*">提交问题</button>
            </div>
        </div>
    </form>
    </div>
</div>
</body>
<script src="./layui/layui.all.js"></script>
<script>
    layui.use(['layer','jquery','laydate','form'],function() {
        var layer = layui.layer,
            form = layui.form,
            laydate = layui.laydate,
            $ = layui.$;
        //执行一个laydate实例
        laydate.render({
            elem: '#jc_date' //指定元素
            , min: -5 //7天前
            , max: 0  //7天后
        });
        laydate.render({
            elem: '#zg_date' //指定元素
            , min: 0 //7天前

        });
        //    监听考核开关
        var kh_switch = null;
        form.on('switch(is_kh)', function (data) {
            kh_switch = data.elem.checked;
            if (data.elem.checked) {
                $(".kh_switch").show();
            } else {
                layer.confirm('此操作会清除以下考核信息,要继续吗?', {icon: 3, title: '提示', closeBtn: 0}, function (index) {
                    $(".kh_switch").hide();
                    //清除所有考核信息
                    $("#bkh_bm").val('');
                    $("#bkhr_zw").val('');
                    $("#bkhr_sf").val('');
                    $("#kh_lb").val('');
                    $("#kh_xd").val('');
                    $("#kh_jf").val('');
                    form.render('select');
                    layer.close(index);
                }, function () {
                    $("#is_kh").prop("checked", true);//很简单就不说了哦
                    form.render('checkbox');
                });
            }
        })
        //    监听提交
        form.on('submit(*)', function (data) {
            //如果用户选择了考核，则验证考核必填项
            if (kh_switch) {
                if ($("#bkh_bm").val() == "" || $("#bkhr_sf").val() == "" || $("#kh_lb").val() == "" || $("#kh_xd").val() == "" || $("#kh_jf").val() == "") {
                    layer.alert('您选择了考核,请将考核相关信息填写完整', {icon: 2, title: '提示', shift: 2});
                    return false;
                }
            }
            //判断考核类别与考核减分是否符合要求
            var kh_lb = $('#kh_lb').val();
            var kh_jf = $('#kh_jf').val();
            if (kh_lb == '批评教育') {
                if (kh_jf <= 0 || kh_jf > 5) {
                    layer.alert('批评教育扣分应在1-5分之间!', {icon: 2, title: '提示'});
                    return false;
                } else {
                    kh_jf += 0;
                }
            }
            if (kh_lb == '一般联挂考核') {
                if (kh_jf <= 6 || kh_jf > 20) {
                    layer.alert('联挂考核扣分应在6-20分之间!', {icon: 2, title: '提示'});
                    return false;
                } else {
                    kh_jf += 0;
                }
            }
            if (kh_lb == '严重联挂考核') {
                if (kh_jf != 20) {
                    layer.alert('严重联挂考核扣分应等于20分!', {icon: 2, title: '提示'});
                    return false;
                } else {
                    kh_jf += 0;
                }
            }
            //判断考核减分是不是一个纯数字
            var kh_jf = $("#kh_jf").val();
            if (isNaN(kh_jf)){
                $("#kh_jf").val("");
                layer.alert('考核减分必须是一个纯数字', {icon: 2, title: '提示', shift: 2});
                return false;
            }
            //发起AJAX请求
            $.post('./wtk_add_ok.php',data.field,function (data) {
                var data = $.parseJSON(data);
                if (data.code==0){
                    layer.alert("问题提交成功！",{
                        title:'问题编号:'+data.id,
                        icon:1,
                        shift:4,
                        closeBtn:0
                    },function () {
                        window.location.reload();
                    })
                }else{
                    layer.alert("问题提交失败,失败原因为:<hr>"+data.message,{
                        icon:2,
                        shift:4,
                        area:['380px','200px']
                    })
                }
            })
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
    })

</script>
</html>